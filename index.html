<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penyusun Rencana Pembelajaran Mendalam (RPM) Interaktif</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #374151;
        }
        .section-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            border: 1px solid #e5e7eb;
        }
        .rpm-section {
            display: flex;
            flex-direction: column;
            background-color: white;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }
        .rpm-row {
            display: flex;
            flex-direction: column;
            border-bottom: 1px solid #e5e7eb;
        }
        .rpm-row:last-child {
            border-bottom: none;
        }
        .rpm-category {
            width: 100%;
            padding: 1rem 1.5rem;
            background-color: #1e3a8a;
            border-bottom: 1px solid #1e3a8a;
        }
        .rpm-category h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
        }
        .rpm-content {
            width: 100%;
            padding: 1.5rem;
        }
        #umum .rpm-content {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
        @media (min-width: 768px) {
            .rpm-section { flex-direction: row; }
            .rpm-row { flex-direction: row; }
            .rpm-category {
                width: 25%;
                border-right: 1px solid #1e3a8a;
                border-bottom: none;
                display: flex;
                align-items: center;
                justify-content: flex-start;
            }
            .rpm-category h3 { font-size: 1.125rem; }
            .rpm-content { width: 75%; }
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1e3a8a;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #dbeafe;
            padding-bottom: 0.5rem;
        }
        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #4b5563;
        }
        .text-input, .textarea-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .text-input:focus, .textarea-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px #bfdbfe;
        }
        .textarea-input {
            min-height: 120px;
            resize: vertical;
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.3s, color 0.3s;
            color: #1e40af;
            font-weight: 500;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #3b82f6;
            color: white;
        }
        .action-button {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: background-color 0.3s;
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        .action-button:hover { background-color: #1d4ed8; }
        .action-button.secondary { background-color: #e0e7ff; color: #3730a3; border-color: #c7d2fe; }
        .action-button.secondary:hover { background-color: #c7d2fe; }
        .action-button.danger { background-color: #fee2e2; color: #991b1b; border-color: #fecaca; }
        .action-button.danger:hover { background-color: #fecaca; }
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(17, 24, 39, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            width: 90%;
            max-width: 500px;
            transform: scale(0.95);
            transition: transform 0.3s;
        }
        .modal-overlay.visible .modal-content { transform: scale(1); }
        #toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(200%);
            background-color: #22c55e;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.5s ease-in-out;
            z-index: 100;
        }
        #toast.show { transform: translateX(-50%) translateY(0); }
        .autocomplete-item {
            padding: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .autocomplete-item:hover {
            background-color: #eef2ff;
        }

        /* Header khusus untuk cetakan */
        .print-header {
            display: none;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #1e3a8a;
            text-align: left;
        }

        @media print {
            /* Pengaturan ukuran kertas F4 dengan margin baru */
            @page {
                size: 21cm 33cm;
                margin: 2cm 1cm 1.5cm 1.5cm;
            }
            
            body { 
                font-size: 9pt; 
                line-height: 1.2; 
                background-color: white; 
                margin: 0;
                padding: 0;
                width: 21cm;
                height: 33cm;
            }
            
            /* Menampilkan header khusus untuk cetakan */
            .print-header {
                display: block;
                page-break-after: avoid;
                margin-bottom: 0.5rem;
                margin-top: 0.5cm; /* Tambahan jarak dari ujung kertas */
            }
            
            .print-header .logo-container {
                float: left;
                margin-right: 1rem;
            }
            
            .print-header img {
                height: 70px;
                width: auto;
            }
            
            .print-header .school-info {
                overflow: hidden;
            }
            
            .print-header .school-name {
                font-size: 14pt;
                font-weight: bold;
                margin: 0 0 0.1rem 0;
                color: #1e3a8a;
                text-align: left;
            }
            
            .print-header .document-title {
                font-size: 12pt;
                font-weight: bold;
                margin: 0 0 0.1rem 0;
                color: #1e3a8a;
                text-align: left;
            }
            
            .print-header .school-address {
                font-size: 9pt;
                margin: 0;
                line-height: 1.2;
                text-align: left;
            }
            
            /* Sembunyikan elemen yang tidak perlu dicetak */
            header, .action-buttons, .print-info, footer, .ai-button, #upload-signature-btn,
            .placeholder-text, .invisible {
                display: none !important;
            }
            
            main { 
                padding: 0 !important; 
                margin: 0 auto !important;
                width: 21cm;
                max-width: 21cm;
            }
            
            h1 { 
                font-size: 16pt; 
                margin-bottom: 0.5rem !important; 
                text-align: center;
            }
            
            .section-card, .rpm-section { 
                box-shadow: none; 
                border: 1px solid #cccccc; 
                padding: 0.3rem; 
                margin-bottom: 0.5rem; 
                page-break-inside: avoid; 
            }
            
            /* Perkecil jarak antar baris di bagian informasi umum */
            #umum .rpm-row {
                padding: 0.1rem 0;
                min-height: auto;
            }
            
            #umum .rpm-content {
                padding: 0.2rem 0.5rem;
            }
            
            #umum .input-label {
                margin-bottom: 0.1rem;
                font-size: 8pt;
            }
            
            #umum .text-input {
                padding: 0.2rem 0.3rem;
                font-size: 8pt;
                min-height: auto;
                height: auto;
            }
            
            .rpm-row { 
                border-bottom: 1px solid #cccccc; 
                padding: 0.2rem 0;
            }
            
            .rpm-content { 
                padding: 0.3rem 0.5rem; 
            }
            
            .rpm-category { 
                background-color: #1e3a8a !important; 
                border-right-color: #1e3a8a !important; 
                -webkit-print-color-adjust: exact; 
                color-adjust: exact; 
                padding: 0.5rem 1rem;
            }
            
            .rpm-category h3 { 
                color: #ffffff !important; 
                font-size: 9pt;
                margin: 0;
            }
            
            .section-title { 
                font-size: 12pt; 
                color: black; 
                border-bottom: 1px solid #d1d5db; 
                padding-bottom: 0.2rem; 
                margin-bottom: 0.5rem; 
            }
            
            .input-label { 
                margin-bottom: 0.2rem; 
                font-size: 9pt;
            }
            
            .text-input, .textarea-input { 
                border: none; 
                padding: 0; 
                background-color: #f9fafb !important; 
                -webkit-print-color-adjust: exact; 
                color-adjust: exact; 
                border-radius: 0; 
                min-height: auto; 
                color: black !important; 
                height: auto !important; 
                overflow: visible !important; 
                font-size: 9pt;
            }
            
            .textarea-input { 
                padding: 0.3rem; 
                border: 1px dashed #d1d5db; 
                min-height: 60px;
                font-size: 9pt;
            }
            
            p, .input-label { 
                color: black !important; 
            }

            /* Pengaturan tanda tangan yang lebih baik */
            #pengesahan {
                page-break-inside: avoid;
                margin-top: 0.5rem;
            }
            
            #pengesahan .signature-container {
                height: 60px !important;
                min-height: 60px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0.2rem 0;
            }
            
            #pengesahan img {
                display: block !important;
                max-height: 50px !important;
                height: 50px !important;
                width: auto !important;
                margin: 0 auto !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }
            
            /* Khusus untuk tanda tangan KS yang sudah ada teksnya */
            #pengesahan .ks-signature-container {
                height: 70px !important;
                min-height: 70px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0.2rem 0;
            }
            
            #pengesahan .ks-signature-container img {
                max-height: 60px !important;
                height: 60px !important;
            }
            
            #guru-signature-img.hidden {
                display: none !important;
            }
            
            /* Hilangkan placeholder text */
            .text-input::placeholder,
            .textarea-input::placeholder {
                color: transparent !important;
            }
            
            /* Memastikan konten tidak melebihi halaman */
            .rpm-section, .section-card {
                break-inside: avoid;
            }
            
            /* Pengaturan untuk checkbox */
            input[type="checkbox"] {
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
                transform: scale(0.8);
            }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-10 shadow-sm border-b border-gray-200">
        <nav class="container mx-auto px-4 lg:px-8 py-3">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div>
                    <h1 class="text-xl font-bold text-blue-800">RPM Interaktif</h1>
                    <p class="text-sm font-semibold text-gray-700 -mt-1">SMK N 1 Purbalingga</p>
                </div>
                <div class="hidden md:flex flex-wrap items-center gap-2">
                    <a href="#umum" class="nav-link active">Informasi Umum</a>
                    <a href="#identifikasi" class="nav-link">Identifikasi</a>
                    <a href="#desain" class="nav-link">Desain</a>
                    <a href="#pengalaman" class="nav-link">Pengalaman</a>
                    <a href="#asesmen" class="nav-link">Asesmen</a>
                    <a href="#pengesahan" class="nav-link">Pengesahan</a>
                    <a href="#lampiran" class="nav-link">Lampiran</a>
                </div>
                <div class="action-buttons flex items-center gap-2">
                     <button id="saveBtn" title="Simpan Progres" class="action-button secondary">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M5 4a2 2 0 012-2h6a2 2 0 012 2v12a2 2 0 01-2 2H7a2 2 0 01-2-2V4zm3 0a1 1 0 011-1h2a1 1 0 011 1v3a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z" /></svg>
                         <span class="hidden sm:inline">Simpan</span>
                     </button>
                     <button id="clearBtn" title="Kosongkan Isian" class="action-button danger">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                         <span class="hidden sm:inline">Kosongkan</span>
                     </button>
                     <button id="printBtn" title="Cetak RPM" class="action-button">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clip-rule="evenodd" /></svg>
                         <span class="hidden sm:inline">Cetak</span>
                     </button>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 lg:px-8 py-8">
        <!-- Header khusus untuk cetakan -->
        <div class="print-header">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/id/thumb/a/a4/Logo_SMK_Negeri_1_Purbalingga.png/250px-Logo_SMK_Negeri_1_Purbalingga.png" alt="Logo SMK Negeri 1 Purbalingga">
            </div>
            <div class="school-info">
                <h1 class="school-name">SMK NEGERI 1 PURBALINGGA</h1>
                <h2 class="document-title">RENCANA PEMBELAJARAN MENDALAM</h2>
                <p class="school-address">Jl. Mayor Jend. Sungkono No.34, Selabaya, Kec. Kalimanah, Kabupaten Purbalingga, Jawa Tengah 53371</p>
            </div>
        </div>

        <h1 class="text-3xl font-bold text-center text-blue-800 mb-8">Rencana Pembelajaran Mendalam</h1>

        <!-- Bagian Informasi Umum -->
        <div id="umum" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Informasi Umum</h3></div>
            <div class="w-full">
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="satuan-pendidikan">Satuan Pendidikan</label><div class="md:col-span-2"><input type="text" id="satuan-pendidikan" class="text-input" value="SMK Negeri 1 Purbalingga" readonly></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-start gap-2 md:gap-4"><label class="input-label md:col-span-1 pt-2" for="nama-guru">Nama Guru & NIP</label><div class="md:col-span-2 grid grid-cols-2 gap-4"><div class="relative"><input type="text" id="nama-guru" class="text-input" placeholder="Ketik nama guru..." autocomplete="off"><div id="autocomplete-list" class="absolute z-20 w-full bg-white border border-gray-300 rounded-b-md shadow-lg max-h-60 overflow-y-auto hidden"></div></div><input type="text" id="nip-guru" class="text-input" placeholder="NIP..."></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="kelas">Kelas/ Semester/ Fase</label><div class="md:col-span-2 grid grid-cols-3 gap-4"><input type="text" id="kelas" class="text-input" placeholder="X"><input type="text" id="semester" class="text-input" placeholder="Ganjil"><input type="text" id="fase" class="text-input" placeholder="E"></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="mata-pelajaran">Mata Pelajaran</label><div class="md:col-span-2"><input type="text" id="mata-pelajaran" class="text-input" placeholder="Contoh: Dasar-dasar Teknik Otomotif"></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="elemen">Elemen</label><div class="md:col-span-2"><input type="text" id="elemen" class="text-input" placeholder="Contoh: Proses bisnis bidang otomotif"></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="materi-ajar">Materi Ajar/ Topik</label><div class="md:col-span-2"><input type="text" id="materi-ajar" class="text-input" placeholder="Contoh: K3 di tempat kerja"></div></div></div>
                <div class="rpm-row"><div class="rpm-content w-full grid grid-cols-1 md:grid-cols-3 items-center gap-2 md:gap-4"><label class="input-label md:col-span-1" for="alokasi-waktu">Alokasi Waktu</label><div class="md:col-span-2"><input type="text" id="alokasi-waktu" class="text-input" placeholder="Contoh: 6 JP (2 x Pertemuan)"></div></div></div>
            </div>
        </div>
       
        <!-- Bagian Identifikasi -->
        <div id="identifikasi" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Identifikasi</h3></div>
            <div class="w-full">
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="identifikasi-peserta" class="input-label">Peserta Didik</label>
                        <textarea id="identifikasi-peserta" class="textarea-input" placeholder="Jelaskan hasil identifikasi kesiapan peserta didik, minat, latar belakang, dan kebutuhan belajar, serta aspek lainnya."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="identifikasi-materi" class="input-label">Materi Pelajaran</label>
                        <textarea id="identifikasi-materi" class="textarea-input" placeholder="Jelaskan identifikasi materi pelajaran faktual, konseptual, prosedural..."></textarea>
                    </div>
                </div>
                <div class="rpm-row"><div class="rpm-content w-full"><label class="input-label">Dimensi Profil Lulusan</label><div id="dimensi-profil" class="grid grid-cols-2 sm:grid-cols-4 gap-4 mt-2"><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Keimanan dan Ketaqwaan...</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Penalaran Kritis</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Kolaborasi</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Kesehatan</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Kewargaan</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Kreativitas</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Kemandirian</span></label><label class="flex items-center space-x-2"><input type="checkbox" class="h-4 w-4 text-blue-600 focus:ring-blue-500 rounded"><span>Komunikasi</span></label></div></div></div>
            </div>
        </div>

        <!-- Bagian Desain Pembelajaran -->
        <div id="desain" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Desain Pembelajaran</h3></div>
            <div class="w-full">
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-capaian" class="input-label">Capaian Pembelajaran</label>
                        <textarea id="desain-capaian" class="textarea-input" placeholder="Contoh: Di akhir fase E peserta dapat menyelesaikan sistem persamaan linear dua variabel melalui beberapa cara untuk penyelesaian masalah."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-lintas-disiplin" class="input-label">Lintas Disiplin Ilmu</label>
                        <textarea id="desain-lintas-disiplin" class="textarea-input" placeholder="Jelaskan integrasi dengan mata pelajaran lain..."></textarea>
                    </div>
                </div>
                 <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-tujuan" class="input-label">Tujuan Pembelajaran</label>
                        <textarea id="desain-tujuan" class="textarea-input" placeholder="Tuliskan tujuan pembelajaran yang spesifik dan terukur (ABCD)..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-topik" class="input-label">Topik Pembelajaran</label>
                        <textarea id="desain-topik" class="textarea-input" placeholder="Rekomendasi topik per pertemuan..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-pedagogis" class="input-label">Praktik Pedagogis</label>
                        <textarea id="desain-pedagogis" class="textarea-input" placeholder="Rekomendasi Model/Strategi/Metode per pertemuan..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-kemitraan" class="input-label">Kemitraan Pembelajaran</label>
                        <textarea id="desain-kemitraan" class="textarea-input" placeholder="Rekomendasi mitra kolaborasi (guru, orang tua, komunitas)..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-lingkungan" class="input-label">Lingkungan Pembelajaran</label>
                        <textarea id="desain-lingkungan" class="textarea-input" placeholder="Desain lingkungan belajar (fisik, virtual, budaya)..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="desain-digital" class="input-label">Pemanfaatan Digital</label>
                        <textarea id="desain-digital" class="textarea-input" placeholder="Rekomendasi 3 jenis pemanfaatan teknologi digital..."></textarea>
                    </div>
                </div>
            </div>
        </div>
       
        <!-- Bagian Pengalaman Belajar -->
        <div id="pengalaman" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Pengalaman Belajar</h3></div>
            <div class="w-full">
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="pengalaman-awal" class="input-label font-medium text-gray-800">Langkah-langkah Pembelajaran: AWAL</label>
                        <textarea id="pengalaman-awal" class="textarea-input" placeholder="Kegiatan awal (apersepsi, motivasi, dll.) selama 15 menit..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="pengalaman-inti" class="input-label font-medium text-gray-800">Langkah-langkah Pembelajaran: INTI</label>
                        <p class="text-sm text-gray-500 mb-4">Aktivitas pembelajaran mendalam dengan tahapan Memahami, Mengaplikasikan, dan Merefleksi.</p>
                        <textarea id="pengalaman-inti" class="textarea-input" placeholder="Buatkan aktivitas pembelajaran mendalam yang mencakup tahapan Memahami, Mengaplikasikan, dan Merefleksi..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="pengalaman-penutup" class="input-label font-medium text-gray-800">Langkah-langkah Pembelajaran: PENUTUP</label>
                        <textarea id="pengalaman-penutup" class="textarea-input" placeholder="Kegiatan penutup (simpulan, umpan balik, doa) selama 5 menint..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bagian Asesmen -->
        <div id="asesmen" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Asesmen Pembelajaran</h3></div>
            <div class="w-full">
                 <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="asesmen-awal" class="input-label font-medium text-gray-800">Asesmen pada Awal Pembelajaran</label>
                        <textarea id="asesmen-awal" class="textarea-input" placeholder="Jelaskan asesmen diagnostik untuk mengetahui kesiapan dan pengetahuan awal..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="asesmen-proses" class="input-label font-medium text-gray-800">Asesmen pada Proses Pembelajaran</label>
                        <textarea id="asesmen-proses" class="textarea-input" placeholder="Jelaskan asesmen formatif (observasi, diskusi, rubrik) untuk memantau proses belajar..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="asesmen-akhir" class="input-label font-medium text-gray-800">Asesmen pada Akhir Pembelajaran</label>
                        <textarea id="asesmen-akhir" class="textarea-input" placeholder="Jelaskan asesmen sumatif (tes, produk, kisi-kisi) untuk mengukur ketercapaian kompetensi..."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <section id="pengesahan" class="section-card scroll-mt-24">
            <h2 class="section-title">Lembar Pengesahan</h2>
            <div class="flex justify-end pt-4"><div class="text-left"><p id="signature-date">Purbalingga, ..........................</p></div></div>
            <div class="flex flex-col md:flex-row justify-center items-start pt-2 text-center gap-8 md:gap-12">
                <div class="w-full md:w-auto md:max-w-[260px] flex-1">
                    <p>Mengetahui,</p>
                    <p class="font-semibold">Kepala Sekolah</p>
                    <div class="ks-signature-container">
                        <!-- Tanda Tangan Kepala Sekolah dari ImageKit (sudah ada teks) -->
                        <img src="https://ik.imagekit.io/szyueti8m/ttd%20KS%20-%20Diedit%20-%20Diedit%20-%20Diedit.png?updatedAt=1761382931279" alt="Tanda Tangan Kepala Sekolah">
                    </div>
                    <!-- Teks nama dan NIP dihilangkan karena sudah ada di gambar -->
                </div>
                <div class="w-full md:w-auto md:max-w-[260px] flex-1">
                    <p class="placeholder-text">Placeholder</p>
                    <p class="font-semibold">Waka Kurikulum</p>
                     <div class="signature-container">
                        <!-- Tanda Tangan Waka Kurikulum dari ImageKit -->
                        <img src="https://ik.imagekit.io/szyueti8m/Tanpa%20judul%20(3,370%20x%202,125).png?updatedAt=1761383002551" alt="Tanda Tangan Waka Kurikulum">
                    </div>
                    <p class="font-semibold underline mt-1">Satyo Nugroho, S.Kom</p>
                    <p class="text-sm">NIP. 197807142009031006</p>
                </div>
                <div class="w-full md:w-auto md:max-w-[260px] flex-1">
                    <p class="placeholder-text">Placeholder</p>
                    <p class="font-semibold">Guru Mata Pelajaran</p>
                    <div class="signature-container">
                        <img id="guru-signature-img" class="hidden" alt="Tanda Tangan Guru">
                    </div>
                    <button type="button" id="upload-signature-btn" class="text-sm text-blue-600 hover:underline -mt-1">Unggah Tanda Tangan</button>
                    <input type="file" id="signature-upload-input" class="hidden" accept="image/png, image/jpeg">
                    <p class="font-semibold underline mt-1" id="guru-name-signature">...................................</p>
                    <p class="text-sm" id="guru-nip-signature">NIP. .........................</p>
                </div>
            </div>
        </section>

        <!-- Bagian Lampiran -->
        <div id="lampiran" class="rpm-section scroll-mt-24">
            <div class="rpm-category"><h3>Lampiran</h3></div>
            <div class="w-full">
                 <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="lampiran-diagnostik" class="input-label font-medium text-gray-800">Asesmen Diagnostik Non-Kognitif</label>
                        <textarea id="lampiran-diagnostik" class="textarea-input" placeholder="Instrumen untuk mengukur minat, motivasi, gaya belajar, dll..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="lampiran-rubrik-diskusi" class="input-label font-medium text-gray-800">Rubrik Penilaian Diskusi</label>
                        <textarea id="lampiran-rubrik-diskusi" class="textarea-input" placeholder="Rubrik untuk menilai kolaborasi, penyampaian pendapat, dan kerja sama..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="lampiran-rubrik-presentasi" class="input-label font-medium text-gray-800">Rubrik Penilaian Presentasi</label>
                        <textarea id="lampiran-rubrik-presentasi" class="textarea-input" placeholder="Rubrik untuk menilai kemampuan berbicara, bertanya, dan kontribusi kelompok..."></textarea>
                    </div>
                </div>
                <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="lampiran-lkpd" class="input-label font-medium text-gray-800">Lembar Kerja Peserta Didik (LKPD)</label>
                        <textarea id="lampiran-lkpd" class="textarea-input" placeholder="LKPD lengkap dengan petunjuk, sintaks, dan tahapan memahami, mengaplikasikan, merefleksikan..."></textarea>
                    </div>
                </div>
                 <div class="rpm-row">
                    <div class="rpm-content w-full">
                        <label for="lampiran-materi" class="input-label font-medium text-gray-800">Materi Ajar</label>
                        <textarea id="lampiran-materi" class="textarea-input" placeholder="Materi ajar lengkap dengan judul, pendahuluan, isi, dan penutup..."></textarea>
                    </div>
                </div>
            </div>
        </div>


    </main>

    <footer class="text-center py-8 text-gray-500 text-sm">
        <p>RPM Interaktif.</p>
        <p>&copy; <span id="current-year"></span> SMK N 1 Purbalingga. All Rights Reserved.</p>
    </footer>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle" class="text-xl font-bold text-gray-800 mb-2">Konfirmasi</h3>
            <p id="modalMessage" class="text-gray-600 mb-6">Apakah Anda yakin ingin melanjutkan?</p>
            <div class="flex justify-end gap-4">
                <button id="modalCancelBtn" class="action-button secondary">Batal</button>
                <button id="modalConfirmBtn" class="action-button">Yakin</button>
            </div>
        </div>
    </div>
   
    <div id="toast"><p id="toastMessage"></p></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- CONSTANTS & STATE ---
            const STORAGE_KEY = 'rpmInteractiveData';
            
            const teacherData = {
            "Maryono S.Pd, M.Si": "196607012000121002", 
            "Dra. Sri Mularsih": "196706201994122001", 
            "Drs. Fiva Widiarto": "196510231996011002", 
            "Wahyu Budi Susapti, S.Pd, MM.": "197207291997022002", 
            "Marwoto, S.Pd, S.Kom": "196904082000121001", 
            "Sri Endah Swarastuti, S.Pd": "197407022003122004", 
            "Dra. Cukat Budi Rahayu": "196901121994032010", 
            "Dra. Diah Ayu Supriyanti": "196603261994122004", 
            "Justina Trirahaju Leksanawati, S.Pd., M.Si.": "197104162003122006", 
            "Sri Wahyuni, S.Pd": "197008022002122004", 
            "Dwi Agus Tri M.M., S.Pd": "197102232002122004", 
            "Sumardi, S.Pd., S.Kom": "197305272003121002", 
            "Agung Pamuji, S.Pd": "197402132005011008", 
            "Retnowati, S.Pd": "197303272005012009", 
            "Tony Eka Martin Wibowo, S.Si.": "197912092005011004", 
            "Nur Romlah, S.Pd": "197509082008012008", 
            "Deddy Suwito, S.Kom": "197209022006041013", 
            "Agus Wuryanto, S.Pd": "197503222006041002", 
            "Tri Puji Utami, S.Kom": "198304252009032009", 
            "Puji Pertiwi Sayekti, S.Pd": "196805102005012011", 
            "Nur Fajriyahti, S.Pd.": "197005212007012014", 
            "Srirahayu, S.Pd.": "197408042008012009", 
            "Romidin, S.Pd": "197505052008011021", 
            "Teguh Cahyono, S.Pd.": "198110232006041010", 
            "Seto Eko Purwanto, S.Si": "197804232010011009", 
            "Nelly Amaliyah, S.Psi": "197907032010012019",
            "Satyo Nugroho, S.Kom.": "197807142009031006",
            "Suratno, S.Pd": "198409032010011012", 
            "Vektor Realita Aditopo, S.Pd": "198603312011011003", 
            "Adi Setiawan, S.Pd.": "199012292014021001", 
            "Galih Tyas Anjari, S.Pd.": "199201212014022001", 
            "Deti Lestiyorini, S.Pd.": "198912142014022001", 
            "Mahzun, S.Pd I": "197601072008011009", 
            "Sugeng Pitoyo, S.Pd.": "197311032008011002", 
            "Asriyatun, S.Pd": "199208262020122009", 
            "Nur Laeli, S.Pd": "199704112020122011", 
            "Sepudin Zupri, S.Kom": "197010222022211001", 
            "Arif Nurokhman, S.Pd": "198010172022211002", 
            "Elis Sugiarti, S.Pd.": "198503072022212028", 
            "Sudiyarti, S.Pd": "198511182022212012", 
            "Otiah, S.Pd.": "198802242022212013", 
            "Novaristya Widyasmara Pamungkas, S.Pd": "198811042022211004", 
            "Menik Yuni Hartini, S.Pd.": "198906292022212008", 
            "Baiq Nur Aisyah, S.Pd.": "198909222022212005", 
            "Sulistiono, S.Pd.": "199112202022211007", 
            "Isria Rizqona Firdausyi, S.Pd.": "199201312022212011", 
            "Hindun Fatmawati, S.Pd.": "199210042022212007", 
            "Ana Nurlatifah, S.Pd.": "199304032022212014", 
            "Dwi Inayah Rahmawati, M.Pd.": "199311282022212011", 
            "Danu Dwi Jatmiko, S.Pd.": "199401192022211003", 
            "Restu Afri Widhi Hastutiningsih, S.Pd.": "199604032022212009", 
            "Nining Setiani, S.Pd.": "199610102022212008", 
            "Kukuh Pribadi, S.Pd.": "198610232022211006", 
            "Yekti Apriyoni, S.Pd.": "197804272023212002", 
            "Novita Adhimurti, S.Pd.": "197811142023212001", 
            "Khamsyatun Yudiana, S.Pd.I.": "198207132023212011", 
            "Nanang Cahyana, S.Pd.Ing.": "198603172023211003", 
            "Waskito Ismu Hastomo, S.Pd.": "198606092023211007", 
            "Lely Erawati, S.Pd.": "198708212023212018", 
            "Septian Endro Laksono, S.Pd.": "199009052023211004", 
            "Firmanika Rozaqi, S.Pd.": "199104242023212024", 
            "Devi Artati, S.Pd.": "199210112023212020", 
            "Soviatun Khasanah, S.Pd.": "199606302023212006", 
            "Miftah Iskandar, S.Pd.": "198512112023211006", 
            "Dista Puspitasari Adi, S.Pd.": "198603182024212004", 
            "Rita Wijiarti, S.Pd.": "199410172024212021", 
            "Safa Aulia Astri, S.Sos": "199607212024212021", 
            "Slamet Suparman, S.Pd.": "-", 
            "Devi Dwi Wahyuni, S.Pd.": "-", 
            "Agus Sutono, S.Pd.": "197406182025211007",
            "Yanti Karadina, S.Pd.": "197512172025212006",
            "Widia Sukaesih, S.E.": "197810082025212008",
            "Triyanto, S.Pd.": "198411252025211021",
            "Inayatul Munawaroh, S.Pd.": "199301062025212023",
            "Danu Setio Aji, S.Pd.": "199310162025211021",
            "Hera Dwi Suryandari, S.Pd.": "199312262025212012",
            "Rindhi Rezqi Hertindha, M.Pd.": "-",
            "Seli Fadriyah, S.Pd.": "-",
            "Nurhidayah, S.S., M.Pd.": "-",
            "Prana Prakasita, S.Pd.": "-",
            "Rita Puspitasari, S.Pd.": "-",
            "Ullil Hykmah, S.Pd.": "-",
            "Muhammad Idris Afandi, S.S., M.Pd.": "-",
            };
            
            // --- DOM Element Selection ---
            const printBtn = document.getElementById('printBtn');
            const saveBtn = document.getElementById('saveBtn');
            const clearBtn = document.getElementById('clearBtn');
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main > div, main > section');
            const namaGuruInput = document.getElementById('nama-guru');
            const nipGuruInput = document.getElementById('nip-guru');
            const guruNameSignature = document.getElementById('guru-name-signature');
            const guruNipSignature = document.getElementById('guru-nip-signature');
            const textareas = document.querySelectorAll('.textarea-input');
            const formInputs = document.querySelectorAll('.text-input, .textarea-input, input[type="checkbox"]');
           
            const confirmationModal = document.getElementById('confirmationModal');
            const modalCancelBtn = document.getElementById('modalCancelBtn');
           
            const uploadSignatureBtn = document.getElementById('upload-signature-btn');
            const signatureUploadInput = document.getElementById('signature-upload-input');
            const guruSignatureImg = document.getElementById('guru-signature-img');
           
            const toast = document.getElementById('toast');
            const autocompleteList = document.getElementById('autocomplete-list');
           
            // --- UTILITY FUNCTIONS ---
            const showToast = (message, isSuccess = true) => {
                toast.querySelector('#toastMessage').textContent = message;
                toast.style.backgroundColor = isSuccess ? '#22c55e' : '#ef4444';
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            };

            const showConfirmationModal = (title, message, onConfirm) => {
                confirmationModal.querySelector('#modalTitle').textContent = title;
                confirmationModal.querySelector('#modalMessage').textContent = message;
                confirmationModal.querySelector('#modalConfirmBtn').onclick = () => {
                    onConfirm();
                    hideConfirmationModal();
                };
                confirmationModal.classList.add('visible');
            };

            const hideConfirmationModal = () => confirmationModal.classList.remove('visible');

            const resizeTextarea = (textarea) => {
                if (!textarea) return;
                textarea.style.height = 'auto';
                textarea.style.height = (textarea.scrollHeight) + 'px';
            };

            const setSignatureDate = () => {
                const dateElement = document.getElementById('signature-date');
                const today = new Date();
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                dateElement.textContent = `Purbalingga, ${today.toLocaleDateString('id-ID', options)}`;
            };

            const setFooterYear = () => {
                document.getElementById('current-year').textContent = new Date().getFullYear();
            };
           
            // --- DATA HANDLING FUNCTIONS ---
            const saveData = () => {
                const data = {};
                formInputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        const key = input.parentElement.textContent.trim();
                        data[key] = input.checked;
                    } else if (input.id) {
                        data[input.id] = input.value;
                    }
                });
               
                const signatureSrc = guruSignatureImg.src;
                if (signatureSrc && signatureSrc.startsWith('data:image')) {
                    data['guruSignatureSrc'] = signatureSrc;
                }

                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
                showToast('Progres berhasil disimpan!');
            };

            const loadData = () => {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    formInputs.forEach(input => {
                        if (input.type === 'checkbox') {
                            const key = input.parentElement.textContent.trim();
                            if (data[key] !== undefined) {
                                input.checked = data[key];
                            }
                        } else if (input.id && data[input.id] !== undefined) {
                            input.value = data[input.id];
                        }
                    });

                    if (data['guruSignatureSrc']) {
                        guruSignatureImg.src = data['guruSignatureSrc'];
                        guruSignatureImg.classList.remove('hidden');
                    }

                    namaGuruInput.dispatchEvent(new Event('input'));
                    nipGuruInput.dispatchEvent(new Event('input'));
                    textareas.forEach(resizeTextarea);
                    showToast('Progres sebelumnya berhasil dimuat.');
                    return true;
                }
                return false;
            };

            const clearData = () => {
                formInputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else if (!input.readOnly) {
                        input.value = '';
                    }
                });
               
                guruSignatureImg.src = '';
                guruSignatureImg.classList.add('hidden');

                localStorage.removeItem(STORAGE_KEY);
                namaGuruInput.dispatchEvent(new Event('input'));
                nipGuruInput.dispatchEvent(new Event('input'));
                textareas.forEach(resizeTextarea);
                showToast('Semua isian telah dikosongkan.', false);
            };

            // --- EVENT LISTENERS ---
           
            printBtn.addEventListener('click', () => window.print());
            saveBtn.addEventListener('click', saveData);
            clearBtn.addEventListener('click', () => {
                showConfirmationModal('Kosongkan Isian?', 'Semua progres yang belum disimpan akan hilang. Apakah Anda yakin?', clearData);
            });
           
            modalCancelBtn.addEventListener('click', hideConfirmationModal);
            confirmationModal.addEventListener('click', (e) => { if (e.target === confirmationModal) hideConfirmationModal(); });

            uploadSignatureBtn.addEventListener('click', () => {
                signatureUploadInput.click();
            });

            signatureUploadInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        guruSignatureImg.src = e.target.result;
                        guruSignatureImg.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    showToast('Harap pilih file gambar (PNG/JPEG).', false);
                }
            });

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        navLinks.forEach(link => {
                            link.classList.toggle('active', link.getAttribute('href').substring(1) === entry.target.id);
                        });
                    }
                });
            }, { rootMargin: '-40% 0px -60% 0px' });
            sections.forEach(section => observer.observe(section));

            namaGuruInput.addEventListener('input', (e) => {
                guruNameSignature.textContent = e.target.value.trim() || '...................................';
                
                const value = namaGuruInput.value.toLowerCase();
                autocompleteList.innerHTML = '';
                if (!value) {
                    autocompleteList.classList.add('hidden');
                    return;
                }

                const filteredNames = Object.keys(teacherData).filter(name =>
                    name.toLowerCase().includes(value)
                );

                if (filteredNames.length > 0) {
                    filteredNames.forEach(name => {
                        const item = document.createElement('div');
                        item.classList.add('autocomplete-item');
                        item.textContent = name;
                        item.addEventListener('click', () => {
                            namaGuruInput.value = name;
                            nipGuruInput.value = teacherData[name];
                            autocompleteList.classList.add('hidden');
                            namaGuruInput.dispatchEvent(new Event('input', { bubbles: true }));
                            nipGuruInput.dispatchEvent(new Event('input', { bubbles: true }));
                        });
                        autocompleteList.appendChild(item);
                    });
                    autocompleteList.classList.remove('hidden');
                } else {
                    autocompleteList.classList.add('hidden');
                }
            });

            nipGuruInput.addEventListener('input', (e) => {
                guruNipSignature.textContent = e.target.value.trim() ? `NIP. ${e.target.value}` : 'NIP. .........................';
            });
            textareas.forEach(textarea => {
                textarea.addEventListener('input', () => resizeTextarea(textarea));
            });

            document.addEventListener('click', (e) => {
                if (e.target !== namaGuruInput) {
                    autocompleteList.classList.add('hidden');
                }
            });
           
            // --- INITIALIZATION ---
            const initialize = () => {
                setSignatureDate();
                setFooterYear();
                if (localStorage.getItem(STORAGE_KEY)) {
                    showConfirmationModal('Progres Ditemukan', 'Terdapat progres yang tersimpan sebelumnya. Apakah Anda ingin memuatnya?', loadData);
                }
            };

            initialize();
        });
    </script>
</body>
</html>
